<% presenter = Courses::LeaderboardPresenter.new(self, @course) %>

<% content_for(:head) do %>
  <title>Leaderboard | <%= presenter.school_name %></title>
  <%= stylesheet_pack_tag 'courses/leaderboard', 'data-turbolinks-track': 'reload' %>
<% end %>

<div class="row">
  <div class="col-8">
    <div class="clearfix mt-3">
      <% if presenter.previous_page? %>
        <div class="float-left">
          <a class="btn btn-default" href="<%= presenter.previous_page_link %>">
            <i class="fa fa-chevron-left"></i> Previous
          </a>
        </div>
      <% end %>

      <% if presenter.next_page? %>
        <div class="float-right">
          <a class="btn btn-default" href="<%= presenter.next_page_link %>">
            Next <i class="fa fa-chevron-right"></i>
          </a>
        </div>
      <% end %>
    </div>

    <h1>
      Leaderboard
      <span class="leaderboard__date-range font-semibold light-grey-text">
    <%= presenter.start_datestring %> to <%= presenter.end_datestring %>
  </span>
    </h1>

    <p class="mb-2">
      Leaderboards are how we track progress for our students. They <strong>don't show</strong> the best students
      at <%= presenter.school_name %>.
      <br/>
      Rather, they show students <strong>who have improved the most</strong> compared to the previous leaderboard.
    </p>

    <% if presenter.entries.empty? %>
      <div class="leaderboard__inactive-startup-message pt-3">
        <h4 class="font-semibold">
          The leaderboard doesn&rsquo;t have any entries for this period.
        </h4>
      </div>
    <% else %>
      <table class="table table-striped">
        <thead class="brand-secondary">
        <tr>
          <th class="font-semibold">Rank</th>
          <th class="font-semibold">Student</th>
          <th class="font-semibold">Score</th>
        </tr>
        </thead>

        <tbody>
        <% presenter.entries.each do |entry| %>
          <tr>
            <td class="leaderboard__rank">
              <span class="leaderboard__rank-number"><%= entry[:rank] %></span>
              <span class="leaderboard__rank-change">
            <i class="fa fa-<%= entry[:delta_icon] %>"></i>
            <span class="leaderboard__rank-delta"><%= entry[:delta] %></span>
          </span>
            </td>

            <td><%= entry[:founder].name %></td>
            <td><%= entry[:score] %></td>
          </tr>
        <% end %>
        </tbody>
      </table>
    <% end %>
  </div>

  <div class="col-4">
    <% if presenter.entries.any? %>
      <% if presenter.toppers.present? %>
        <h2 class="mt-4">
          <%= presenter.toppers[:names] %> are at the top of the leaderboard this week, sharing a score of
          <strong><%= presenter.toppers[:score] %></strong> points.
        </h2>
      <% else %>
        <h2 class="mt-4">
          <strong><%= presenter.topper[:founder].name %></strong>

          <% if presenter.topper == presenter.newbie %>
            enters the leaderboard at the top spot
          <% else %>
            is at the top of the leaderboard this week
          <% end %>

          with a score of <strong><%= presenter.topper[:score].humanize %></strong>!
        </h2>

        <h2>
          <% if presenter.newbie != presenter.topper %>
            <strong><%= presenter.newbie[:founder].name %></strong> is new on the leaderboard at rank
            <strong><%= presenter.newbie[:rank] %></strong>
          <% end %>
        </h2>
      <% end %>

      <h3 class="mt-3">
        Submissions from <strong><%= presenter.entries.count.humanize %></strong> students were evaluated to
        build this leaderboard.
      </h3>

      <h3 class="mt-3">
        <% if presenter.inactive_students_count.positive? %>
          There <%= 'is'.pluralize(presenter.inactive_students_count) %>
          <strong><%= presenter.inactive_students_count.humanize %> <%= 'students'.pluralize(presenter.inactive_students_count) %></strong>
          who <%= 'was'.pluralize(presenter.inactive_students_count) %> <strong>inactive</strong> during this period.
        <% end %>
      </h3>
    <% end %>
  </div>
</div>
